\chapter{Complex numbers with round-off error}\label{Ch.XComplex} % =~ GMT \S 7


\begin{remark} \label{GMT remark7.1}
The theoretical method for proving Theorem \ref{GMT 0.2}
has been implemented via the computer program {\textit verify}, which is available, together with the relevant data sets, at the {\textit Annals} web site.  To make this computer-aided proof rigorous, we needed to deal with round-off error in calculations.  

One approach to round-off error would be to use interval arithmetic packages to carry out all calculations with floating-point machine numbers, or to generate our own version of these packages.  
However, it appears that this approach
would be much too slow given the size of our collection of sub-boxes and conditions/killerwords.  

To solve this problem of speed, we implement round-off error at a higher level of programing.  That is, we incorporate round-off error directly
 into AffApproxes,  which makes our error calculations more accurate, thereby avoiding much subdivision of
sub-boxes. This necessitates that we incorporate round-off error directly into complex numbers as well. 
In this chapter we show how to do standard operations on complex numbers while keeping track of round-off error.
In the next chapter we work with  AffApproxes.\end{remark}

\begin{definition}\label{GMT def7.2}
There are two types of complex numbers to consider: 

\begin{itemize}
\item[1)]  An {\textit XComplex} $x = (x.{\mathrm re}, x.{\mathrm im})$ corresponds to a complex number that is represented exactly; it
simply consists of a real part and an imaginary part.

\item[2)]  An {\textit AComplex} $x = (x.{\mathrm re}, x.{\mathrm im}; x.e)$ corresponds to an ``interval'' that contains the complex number in
question.  Thus, it consists of an XComplex and a floating-point number representing the error.  In particular, the AComplex
$x$ represents the set $S(x)$ of complex numbers 
$\{w\ :\ |w - (x.{\mathrm re} + i (x.{\mathrm im}))| \le x.e\}$.  Note that $S(x)$ is also defined
for an XComplex if we conceptualize an XComplex as an AComplex with
$x.e = 0.$
\end{itemize}

\end{definition}

\begin{remark}\label{GMT 7.3}
In general,  our operations  act on XComplexes and produce AComplexes, or they act on AComplexes and produce
 AComplexes.  In one case, the unary minus, an XComplex goes to an XComplex.  
In the calculations that follow the effect on the error is the whole point.\end{remark}

\begin{conventions} \label{GMT cs7.4}
We begin, by writing down our basic rules, which follow easily from the IEEE-754 standard for machine arithmetic (see \cite{IEEE}).
(Actually,  the ``hypot" function $h(a,b)$, which computes by elaborate chicanery $\sqrt{a^2 + b^2},$ is not part of the IEEE-754 standard, but  satisfies the appropriate standard according to the documentation provided (see \cite{K1}).)  The operations here are on
double-precision floating-point real numbers (``doubles") and we denote a true operation by the usual symbol and the associated machine operation by the same symbol in a circle, with two exceptions: a machine square root $\sqrt a$ is denoted $\root o \of a$ and the machine version of the hypot function is denoted $h_\circ$.  Perhaps a third exception is our occasional notation of true multiplication by the absence of a symbol.  

There is a finite set of numbers (sometimes called ``machine numbers") which are representable on the computer.  With
technicalities ignored,    a nonzero floating-point number is represented by a fixed number of bits of which
the first determines the sign of the number, the next $m$ represent the exponent, and the remaining $n$ represent the
mantissa of the number.  Because our nonzero numbers start with a 1, that means the $n$ mantissa bits actually represent
the next
$n$ binary digits after the 1.  That is, the mantissa is actually $1.b_1b_2b_3...b_{n}.$   The IEEE-754 standard calls for
64-bit doubles with $m = 11$ and $n = 52.$  We define $EPS$ to be $2^{-n},$ in which case $EPS/2$ is $2^{-(n + 1)}.$  

The IEEE-754 standard states that the result of an operation
 is always the closest representable number to the true solution (as long as we are in the bounds of representable
numbers).  For example, for machine numbers $a$ and~$b$, we have $a \oplus b = m(a+b)$ where $m$ is the function which
takes the machine value of its argument (when it lies in the range of representable numbers).  Thus, properties of the type
$$|(a + b) - (a \oplus b)| \leq (EPS/2) |a + b|$$
follow immediately from the IEEE-754 standard, as long as we do not {\textit underflow} or {\textit overflow} outside of the range of representable numbers. 
Specifically, underflow occurs when the result of an operation is smaller in absolute value than $2^{-1022}$,
 and overflow occurs when the result of an operation is larger in absolute value than roughly $2^{1024}$
	(see \cite{IEEE}, \S 7).

We further note that the formula 
$$|(a + b) - (a \oplus b)| \leq (EPS/2) |a \oplus b|$$
follows because the true answer has ``exponent" which is less than or equal to the exponent of the machine answer.  We reiterate, that in both cases, $a$ and $b$ are assumed to be machine numbers.

Of course, a machine operation such as $\oplus$ must act on doubles, while a ``true" operation such as $+$ can act on reals (which includes doubles).
In this chapter,
long strings of inequalities will be used to prove the various propositions, and care was taken to ensure that machine operations act on machine numbers.  In particular, the various variables appearing in the propositions are assumed to be doubles. The IEEE-754 standard provides for conversions from decimal to binary (within the appropriate range, conversion is to the nearest representable number) and from binary to decimal.  However, these are rarely used in this paper, although a trivial class of exceptions is provided by the decimal numbers in the conditions of
	Chapter \ref{Ch.ConditionsTree}

When calculations underflow or overflow outside of the range of representable numbers, we require that the computer inform us if either exception has occurred. \end{conventions} 
\vglue12pt

\begin{basic properties} \label{GMT basic7.0}(assuming no underflow and no overflow)
\vglue6pt

In the formulas that follow, $a$,$b$, and $A$ are machine numbers and
$1 + k \times EPS = 1 \oplus (k \otimes EPS)$ when $k$ is an integer which is not huge in absolute value (that is, 
smaller than roughly $2^{50}$).  Thus, within the appropriate range,  $1 + k \times EPS$ is a machine number.  Similarly,
$2^k
\times A = 2^k \otimes A$ when $k$ is an integer and  $2^k \otimes A$ neither underflows nor overflows.\end{basic properties}
\begin{eqnarray*}
|(a + b) - (a \oplus b)| &\leq& (EPS/2) |a + b|,\\
|(a + b) - (a \oplus b)|&\leq& (EPS/2) |a \oplus b|,\\
|(a - b) - (a \ominus b)| &\leq& (EPS/2) |a - b|,\\
|(a - b) - (a \ominus b)|&\leq& (EPS/2) |a \ominus b|,\\
|(a \times b) - (a \otimes b)| &\leq& (EPS/2) |a \times b|,\\
|(a \times b) - (a \otimes b)| &\leq&(EPS/2) |a \otimes b|,\\
|(a / b) - (a \oslash b)| &\leq& (EPS/2) |a / b|,\\
|(a / b) - (a \oslash b)| &\leq& (EPS/2) |a \oslash b|,\\
|\sqrt a - \root o \of a| &\leq& (EPS/2) |\sqrt a|,\\
|\sqrt a - \root o \of a|  &\leq&  (EPS/2) |\root o \of a|,\\
|h(a,b) - h_\circ(a,b)| &\leq& (EPS) |h(a,b)|,\\
|h(a,b) - h_\circ(a,b)| &\leq&   (EPS) |h_\circ(a,b)|.
\end{eqnarray*}

 
From these formulas, we immediately compute the following.
\begin{eqnarray*}
(1 - EPS/2) |a + b| &\leq& |a \oplus b| 
\leq (1 + EPS/2) |a+b|, \\ 
  (1 - EPS/2) |a \oplus b|& \leq& |a + b| 
\leq (1 + EPS/2) |a \oplus b|,\\
\noalign{\vskip4pt}
\noalign{\hfil .\hfil }  \noalign{\vskip4pt}
\noalign{\hfil .\hfil } \noalign{\vskip4pt}
\noalign{\hfil .\hfil } \noalign{\vskip4pt}
(1 - EPS/2) |\sqrt a| &\leq&  |\root o \of a| 
\leq (1 + EPS/2) |\sqrt a|, \\ (1 - EPS/2) |\root o \of a|&\leq&  |\sqrt a| 
\leq (1 + EPS/2) |\root o \of a|, \\  (1 - EPS) |h(a,b)| &\leq&  |h_\circ (a,b)| 
\leq (1 + EPS) |h(a,b)|, \\  (1 - EPS) |h_\circ (a,b)| &\leq& |h(a,b)| 
\leq (1 + EPS) |h_\circ (a,b)|.
\end{eqnarray*}
Of course, we can also get the following type of formula, which is sometimes convenient,
 for example, in the proof of Lemma \ref{GMT lemma7.2}:
$$\left({1 \over {1 + {EPS \over 2}}}\right) |a \oplus b| \leq |a + b| 
\leq \left({1 \over {1 - {EPS \over 2}}}\right) |a \oplus b|.$$

Before stating our propositions, we prove two lemmas.

\begin{lemma}\label{GMT 7.0} {\textrm (assuming no underflow and no overflow)}
For machine numbers $a$ and $b${\textrm ,}
$$(1 - EPS) \otimes |a \oplus b| \le |a + b| \le (1 + EPS) \otimes |a \oplus b|.$$
 Analogous formulas hold for $\ -,\ *,\ /,\ \sqrt{}$.
\end{lemma}

\begin{proof}{}
Assume $a+b > 0$.  
If $(1+EPS) \otimes (a \oplus b) < (a+b)$ then the machine number 
$(1+EPS) \otimes (a \oplus b)$ is a better approximation to $a+b$ than $a \oplus b$, because $(a \oplus b) 
< (1+EPS) \otimes (a \oplus b)$.  This contradicts the IEEE standard.  The case $a+b < 0$ can be handled similarly, and the
case $a+b = 0$ is trivial, similarly for the left-hand inequality.
\end{proof}

\begin{lemma}\label{GMT lemma7.1} $$(1 + EPS/2)^a A \le (1 + k EPS) \otimes A$$ 
 where $A$ is a nonnegative machine number{\textrm ,} and $a$ is a {\textrm (}\/not huge\/{\textrm )} integer{\textrm ,} such that
for $a$ even{\textrm ,} $k = {a \over 2} + 1$ and  for $a$ odd, $k = {a+1 \over 2} + 1$. 
\end{lemma}

\begin{proof}{} 
$$(1 + EPS/2)^a A\le (1 - EPS/2)(1 + k EPS) A \le (1 + k EPS) \otimes A.$$ 
The first inequality holds if $a$ and $k$ are as in the lemma, and the second inequality is a consequence of one of the
formulas preceding Lemma \ref{GMT 7.0} ($A \ge 0$). \end{proof}
 
We now begin our construction of complex arithmetic. We will give proofs for most of the operations; the others should be straightforward to derive,
or can be found in the {\textit Annals} web site.
\vglue6pt
\begin{remarks} \label{GMT 7.5}
i) We remind the reader that all machine operations are on machine numbers, and that the various variables appearing in the propositions are assumed to be doubles.
\vglue4pt
ii) The propositions that follow include in their statements the definitions of the various operations (see Remark \ref{GMT 6.6} iii).\end{remarks}

\begin{proposition}\label{GMT prop7.1}{$(-X)$}
If $x$ is an {\textrm XComplex,} then 
$$-x \equiv (-x.{\mathrm re},-x.{\mathrm im}).$$ 
\end{proposition}

\begin{proposition}\label{GMT prop7.2}{$(X + D)$} 
If $x$ is an {\textrm XComplex} and $d$ is a double{\textrm ,} then 
$S(x + d) \supseteq S(x) + S(d)${\textrm ,} where 
 $$x + d \equiv (x.{\mathrm re} \oplus d, x.{\mathrm im};
(EPS/2)\otimes |x.{\mathrm re} \oplus d|).$$
\end{proposition}

\begin{proof}{}
The  error is bounded by  
\vglue12pt
\hfill ${\displaystyle |(x.{\mathrm re} + d) - (x.{\mathrm re} \oplus d)|
\le (EPS/2) | x.{\mathrm re} \oplus d|
  =  (EPS/2) \otimes | x.{\mathrm re} \oplus d|.}$ \end{proof}

\begin{proposition}\label{GMT prop7.3}{$(X - D)$}
If $x$ is an {\textrm XComplex} and $d$ is a double{\textrm ,} then 
$S(x - d) \supseteq S(x) - S(d)${\textrm ,} where 
 $$x - d \equiv (x.{\mathrm re} \ominus d, x.{\mathrm im};
(EPS/2)\otimes |x.{\mathrm re} \ominus d|).$$ \end{proposition}

\begin{proposition}\label{GMT prop7.4}{$(X + X)$}
If $x$ and $y$ are {\textrm XComplexes,} then 
$S(x + y) \supseteq S(x) + S(y)${\textrm ,} where
 \begin{eqnarray*}
x + y &\equiv& (x.{\mathrm re} \oplus y.{\mathrm re}, x.{\mathrm im} \oplus y.{\mathrm im};
(EPS/2)\\
&&  \otimes\ ((1 + EPS)  \otimes (|x.{\mathrm re} \oplus y.{\mathrm re}| \oplus |x.{\mathrm im} \oplus y.{\mathrm im}|))).
\end{eqnarray*}
\end{proposition}
  

\begin{proof}{}
The error is bounded by
\begin{eqnarray*}
&&|(x.{\mathrm re} + y.{\mathrm re}) - (x.{\mathrm re} \oplus y.{\mathrm re})| + 
  |(x.{\mathrm im} + y.{\mathrm im}) - (x.{\mathrm im} \oplus y.{\mathrm im})|\\[4pt]
&&\qquad \le (EPS/2)(| x.{\mathrm re} \oplus y.{\mathrm re}| + 
   |x.{\mathrm im} \oplus y.{\mathrm im}|)\\[4pt]
&&\qquad \le (EPS/2)((1 + EPS) \otimes (| x.{\mathrm re} \oplus y.{\mathrm re}| \oplus 
   |x.{\mathrm im} \oplus y.{\mathrm im}|))\\[4pt]
&&\qquad = (EPS/2) \otimes ((1 + EPS) \otimes (| x.{\mathrm re} \oplus y.{\mathrm re}| \oplus 
   |x.{\mathrm im} \oplus y.{\mathrm im}|)).
\end{eqnarray*}
To go from line 2 to line 3 we used Lemma \ref{GMT 7.0}. \end{proof}

\begin{proposition}\label{GMT prop7.5}{$(X - X)$}
If $x$ and $y$ are {\textrm XComplexes,} then 
$S(x - y) \supseteq S(x) - S(y)${\textrm ,} where
\begin{eqnarray*}
x - y &\equiv& (x.{\mathrm re} \ominus y.{\mathrm re}, x.{\mathrm im} \ominus y.{\mathrm im};\\[4pt]
&&\quad 
(EPS/2)\otimes ((1 + EPS) \otimes (|x.{\mathrm re} \ominus y.{\mathrm re}| \oplus |x.{\mathrm im} \ominus y.{\mathrm im}|))).
\end{eqnarray*} \end{proposition}


\begin{proposition}\label{GMT prop7.6}{$(A + A)$} 
If $x$ and $y$ are {\textrm AComplexes,} then 
$S(x + y) \supseteq S(x) + S(y)${\textrm ,} where
\begin{eqnarray*}
 x+y &\equiv& ({\mathrm re},{\mathrm im};e) \hbox{ with }\\[4pt]
{\mathrm re}& =& x.{\mathrm re} \oplus y.{\mathrm re}\\[4pt]
{\mathrm im}& =& x.{\mathrm im} \oplus y.{\mathrm im}\\[4pt]
e& =& (1 + 2 EPS) \otimes ( ((EPS/2) \otimes (|{\mathrm re}| \oplus |{\mathrm im}|))
 \oplus (x.e \oplus y.e)). \end{eqnarray*}
\end{proposition}

\begin{proof}{}
The error is bounded by the sum of the contributions from the real part, the imaginary part, and the two individual errors:
\begin{eqnarray*}
 & &\hskip-20pt |(x.{\mathrm re} \oplus y.{\mathrm re}) -(x.{\mathrm re} + y.{\mathrm re})| + |(x.{\mathrm im} \oplus y.{\mathrm im}) -
(x.{\mathrm im} + y.{\mathrm im})| + (x.e + y.e).\\[4pt]
&&\hskip-12pt \le (EPS/2) |x.{\mathrm re} \oplus y.{\mathrm re}| + (EPS/2) |x.{\mathrm im} \oplus y.{\mathrm im}| + 
(1 + EPS/2) (x.e \oplus y.e)\\[4pt]
&&\hskip-12pt \le  (1 + EPS/2) (EPS/2)(|x.{\mathrm re} \oplus y.{\mathrm re}| \oplus 
 |x.{\mathrm im} \oplus y.{\mathrm im}| ) \\[4pt]
&&\hskip-12pt \qquad + (1 + EPS/2) (x.e \oplus y.e)\\[4pt]
&&\hskip-12pt = (1 + EPS/2) ((EPS/2)(|x.{\mathrm re} \oplus y.{\mathrm re}| \oplus 
 |x.{\mathrm im} \oplus y.{\mathrm im}| ) + (x.e \oplus y.e))\\[4pt]
&&\hskip-12pt \le (1 + EPS/2)^2 (((EPS/2) (|x.{\mathrm re} \oplus y.{\mathrm re}| \oplus 
 |x.{\mathrm im} \oplus y.{\mathrm im}| )) \oplus  (x.e \oplus y.e))\\[4pt]
&&\hskip-12pt \le   (1 + 2 EPS) \otimes (((EPS/2)\otimes (|x.{\mathrm re} \oplus
y.{\mathrm re}| \oplus |x.{\mathrm im} \oplus y.{\mathrm im}| )) \oplus (x.e \oplus y.e)).\\[4pt]
\noalign{\vskip-24pt}
\end{eqnarray*}
\end{proof}

The precedence for machine operations is the same as that for true operations, so some  parentheses are unnecessary
and will often be omitted in what
 follows.

\begin{proposition}\label{GMT prop7.7}{$(A - A)$}
If $x$ and $y$ are {\textrm AComplexes,} then 
$S(x - y) \supseteq S(x) - S(y)${\textrm ,} where
\begin{eqnarray*}
x-y &\equiv& ({\mathrm re},{\mathrm im};e) \hbox{ with }\\
{\mathrm re}& =& x.{\mathrm re} \ominus y.{\mathrm re}\\
{\mathrm im}& =& x.{\mathrm im} \ominus y.{\mathrm im}\\
e &=& (1 + 2 EPS) \otimes ( ((EPS/2) \otimes (|{\mathrm re}| \oplus |{\mathrm im}|))
 \oplus (x.e \oplus y.e)).
\end{eqnarray*}
\end{proposition}


\begin{proposition}\label{GMT prop7.8}{$(X  \times  D)$} 
If $x$ is an {\textrm XComplex} and $d$ is a double{\textrm ,} then 
$S(x \times d) \supseteq S(x) \times S(d)${\textrm ,} where
\begin{eqnarray*}
x \times d &\equiv& ({\mathrm re},{\mathrm im};e) \hbox{ with}\\[6pt] {\mathrm re} &= &x.{\mathrm re} \otimes d\\[6pt] {\mathrm im} &= &x.{\mathrm im} \otimes d\\[6pt] e &=& (EPS/2) \otimes ((1 + EPS) \otimes (|{\mathrm re}| \oplus |{\mathrm im}|) ). \end{eqnarray*}
\end{proposition}

\begin{proposition}\label{GMT prop7.9}{$(X / D)$} 
If $x$ is an {\textrm XComplex} and $d$ is a double{\textrm ,} then 
$S(x / d) \supseteq S(x) / S(d)${\textrm ,} where
\begin{eqnarray*}
x / d& \equiv& ({\mathrm re},{\mathrm im};e) \hbox{ with }\\[6pt] {\mathrm re}& =& x.{\mathrm re} \oslash d\\[6pt] {\mathrm im} &= &x.{\mathrm im} \oslash d\\[6pt] e& = &(EPS/2) \otimes ((1 + EPS) \otimes (|{\mathrm re}| \oplus |{\mathrm im}|) ).
\end{eqnarray*}
\end{proposition}

\begin{proposition}\label{GMT prop7.10}{$(X  \times  X)$}
If $x$ and $y$ are {\textrm XComplexes,} then 
$S(x \times y) \supseteq S(x) \times S(y)${\textrm ,} where
\begin{eqnarray*}
x \times y &\equiv& ({\mathrm re},{\mathrm im};e)\hbox{ with}\\[6pt] {\mathrm re}& =&{\mathrm  re}1 \ominus {\mathrm re2}, \hbox{ with ${\mathrm re1} = x.{\mathrm re} \otimes y.{\mathrm re}$ and ${\mathrm re}2 =
x.{\mathrm im} \otimes y.{\mathrm im}$} \\[6pt] {\mathrm im}& =& {\mathrm im}1 \oplus {\mathrm im}2, \hbox{ with ${\mathrm im}1 = x.{\mathrm re} \otimes y.{\mathrm im}$ and ${\mathrm im}2 = x.{\mathrm im} \otimes
y.{\mathrm re}$}\\[6pt] e& =& EPS \otimes ((1 + 2EPS) \otimes  ((|{\mathrm re}1| \oplus |{\mathrm re}2|) \oplus  (|{\mathrm im}1| \oplus |{\mathrm im}2|))).
\end{eqnarray*}
\end{proposition}

\begin{proof}{}
The error is bounded by the sum of the contributions from the real part and the imaginary part:
\begin{eqnarray*}
&&|(x.{\mathrm re} \times  y.{\mathrm re} - x.{\mathrm im} \times y.{\mathrm im}) - ((x.{\mathrm re} \otimes y.{\mathrm re}) \ominus
(x.{\mathrm im}
\otimes y.{\mathrm im}))| \\[6pt]
&&\quad + |(x.{\mathrm re} \times  y.{\mathrm im} + x.{\mathrm im} \times y.{\mathrm re}) - ((x.{\mathrm re} \otimes y.{\mathrm re}) \oplus (x.{\mathrm im}
\otimes y.{\mathrm im}))|.
\end{eqnarray*}
   We want to bound this by a machine formula.  Let us begin by bounding 
$$|(x.{\mathrm re} \times  y.{\mathrm re} - x.{\mathrm im} \times y.{\mathrm im}) - ((x.{\mathrm re} \otimes y.{\mathrm re}) \ominus (x.{\mathrm im}
 \otimes y.{\mathrm im}))| $$ 
by a machine formula:
%\eject

\centerline{
${\displaystyle |(x.{\mathrm re} \times  y.{\mathrm re} - x.{\mathrm im} \times y.{\mathrm im}) - ((x.{\mathrm re} \otimes y.{\mathrm re}) \ominus
(x.{\mathrm im}
\otimes y.{\mathrm im}))| }$}
\begin{eqnarray*}
\noalign{\vskip-16pt}
&&\le |((x.{\mathrm re} \times  y.{\mathrm re}) - (x.{\mathrm im} \times y.{\mathrm im})) - ((x.{\mathrm re} \otimes y.{\mathrm re}) -
(x.{\mathrm im}
\otimes y.{\mathrm im}))|\\
&&\quad + |((x.{\mathrm re} \otimes y.{\mathrm re}) - (x.{\mathrm im} \otimes y.{\mathrm im}))-((x.{\mathrm re} \otimes y.{\mathrm re})
\ominus (x.{\mathrm im} \otimes y.{\mathrm im}))| \\
&&\le |(x.{\mathrm re} \times  y.{\mathrm re}) - (x.{\mathrm re} \otimes y.{\mathrm re})| + |(x.{\mathrm
im} \times y.{\mathrm im})- (x.{\mathrm im} \otimes y.{\mathrm im})| \\
&&\quad + (EPS/2)|(x.{\mathrm re} \otimes y.{\mathrm re}) - (x.{\mathrm im} \otimes
y.{\mathrm im})|\\
&&\le (EPS/2)|(x.{\mathrm re} \otimes y.{\mathrm re})| + (EPS/2)|(x.{\mathrm im} \otimes y.{\mathrm im})| \\
&&\quad + (EPS/2)(|x.{\mathrm re} \otimes
y.{\mathrm re}| + |x.{\mathrm im} \otimes y.{\mathrm im}|)\\
&&= (EPS/2)(2) (|x.{\mathrm re} \otimes y.{\mathrm re}| + |x.{\mathrm im} \otimes y.{\mathrm
im}|)\\
&&\le EPS (1 + EPS/2) (|x.{\mathrm re} \otimes y.{\mathrm re}| \oplus |(x.{\mathrm im} \otimes y.{\mathrm im}|) .
\end{eqnarray*}


Almost the exact same calculation produces the analogous formula for the imaginary contribution, and we now combine the
two to get a bound on the total error.  
\begin{eqnarray*}
&&\le EPS (1 + EPS/2) (|x.{\mathrm re} \otimes y.{\mathrm re}| \oplus |x.{\mathrm im} \otimes y.{\mathrm im}|) \\
&&\quad +
EPS (1 + EPS/2) (|x.{\mathrm re} \otimes y.{\mathrm im}| \oplus |x.{\mathrm im} \otimes y.{\mathrm re}| )\\
&&\le EPS \otimes ((1 +
2EPS)\otimes((|x.{\mathrm re} \otimes y.{\mathrm re}| \oplus |x.{\mathrm im} \otimes y.{\mathrm im}| ) \\
&&\quad \oplus
(|x.{\mathrm re} \otimes y.{\mathrm im}| \oplus |x.{\mathrm im} \otimes y.{\mathrm re}| ))).
\\
\noalign{\vskip-36pt}
\end{eqnarray*}
\end{proof}

\begin{proposition}\label{GMT prop7.11}{$(D / X)$}
If $x$ is a double and $y$ is an {\textrm XComplex,} then
$S(x / y) \supseteq S(x) / S(y)${\textrm ,} where
\begin{eqnarray*}
x  / y & \equiv& ({\mathrm re},{\mathrm im};e)\hbox{ with }\\
re& =& (x  \otimes y.{\mathrm re})\oslash nrm \hbox{ where $nrm = y.{\mathrm re} \otimes y.{\mathrm re} \oplus y.{\mathrm im} \otimes
y.{\mathrm im}$}
\\
{\mathrm im} &=& -(x  \otimes y.{\mathrm im}) \oslash nrm\\
e& =& (2EPS) \otimes ((1 +  2EPS)\otimes(|{\mathrm re}| \oplus |{\mathrm im}|)).
\end{eqnarray*}
\end{proposition}

\noindent\emph{Proof.}
The true version of $x/y$ is equal to  
$$(x \times y.{\mathrm re} + i (-x \times y.{\mathrm im}))/ ((y.{\mathrm re})^2 + (y.{\mathrm im})^2)$$ and we need to compare this with the
machine version to find the error.  Further, this error is less than or equal to the sum of the real error and the imaginary
error. Thus, we start with the real calculation (as in the statement of the proposition, we use $nrm$ to represent the
machine version of $(y.{\mathrm re})^2 + (y.{\mathrm im})^2$).
\begin{eqnarray*}
&&\hskip-36pt \left|{x \times y.{\mathrm re}  \over (y.{\mathrm re})^2 + (y.{\mathrm im})^2} - ((x \otimes y.{\mathrm re})\oslash
nrm)\right|\\
&
\le &\left|(x
\otimes y.{\mathrm re}) \oslash nrm - {x \otimes y.{\mathrm re} \over nrm}\right|\\
&& +\ \left|{x \otimes y.{\mathrm re} \over nrm} - {x
\times y.{\mathrm re}
\over nrm}\right| + \left|{x \times y.{\mathrm re} \over nrm} - 
{x \times y.{\mathrm re}  \over (y.{\mathrm re})^2 + (y.{\mathrm im})^2}\right|.
\end{eqnarray*}
 
Before continuing, let us compare ${1 \over nrm}$ and ${1 \over (y.{\mathrm re})^2 + (y.{\mathrm im})^2}$ by developing a formula for
comparing ${1 \over a^2 + b^2}$ and its associated ${1 \over nrm}$:
\begin{lemma}\label{GMT lemma7.2} $$\left|{1 \over nrm} - {1 \over a^2 + b^2}\right| \le   (EPS + (EPS/2)^2) {1 \over nrm}$$
{\textit where} $nrm = a\otimes a \oplus b \otimes b.$
\end{lemma}

\begin{proof}{}
We compute that 
$$\left({1 \over 1 + EPS/2}\right)^2 \times nrm
\le a^2 + b^2 
\le \left({1 \over 1 - EPS/2}\right)^2 \times nrm;$$ hence 
$${1 \over nrm} (1 - EPS/2)^2 
\le {1 \over a^2 + b^2}
\le {1 \over nrm} (1 + EPS/2)^2.$$  It then follows that 
\begin{eqnarray*}
\left|{1 \over nrm} - {1 \over a^2 + b^2}\right|& \le &
    {1 \over nrm} (1 + EPS/2)^2 - {1 \over nrm}\\
&=& {1 \over nrm} ((1 + EPS/2)^2 - 1) =
  (EPS + (EPS/2)^2){1 \over nrm} .\\
\noalign{\vskip-24pt}
\end{eqnarray*}
\end{proof}

\phantom{someone}
Getting back to our main calculation (with $nrm = y.{\mathrm re} \otimes y.{\mathrm re} \oplus y.{\mathrm im} \otimes y.{\mathrm im}$), we
have
\begin{eqnarray*}
&&\hskip-16pt\left|(x \otimes y.{\mathrm re}) \oslash nrm - {x \otimes y.{\mathrm re} \over nrm}\right|\\
&&\quad +
\left|{x \otimes y.{\mathrm re} \over nrm} - {x \times y.{\mathrm re} \over nrm}\right| +
\left|{x \times y.{\mathrm re} \over nrm} - 
{x \times y.{\mathrm re}  \over (y.{\mathrm re})^2 + (y.{\mathrm im})^2}\right|\\
&&  \le(EPS/2){|x \otimes y.{\mathrm re}| \over nrm} +
        (EPS/2){|x \otimes   y.{\mathrm re}| \over nrm} +
(EPS + (EPS/2)^2) {|x \times   y.{\mathrm re}| \over nrm}\\
&&  =(EPS/2)\left({1 \over nrm}\right)(2 |x \otimes y.{\mathrm re}| +
(2 + EPS/2) \times |x \times y.{\mathrm re}| )\\
&&  \le (EPS/2)\left({1 \over nrm}\right)(2 |x \otimes y.{\mathrm re}| +
(2 + EPS/2)(1 + EPS/2) \times |x \otimes y.{\mathrm re}| )\\
&&\quad = (EPS/2)\left({1 \over nrm}\right)(|x \otimes y.{\mathrm re}|)
(2 + (2 + EPS/2)(1+EPS/2))\\
&&  \le (EPS/2)(4 + 3EPS/2 + (EPS/2)^2)(|x \otimes y.{\mathrm re}|)\left({1 \over nrm}\right)\\
&& \le (EPS/2)(4 + 3EPS/2 +
(EPS/2)^2)(1+EPS/2)(|x \otimes y.{\mathrm re}| \oslash nrm)\\
&&  \le (2EPS)(1 + 3EPS/8 + (EPS/4)^2)(1+EPS/2)(|(x \otimes y.{\mathrm
re} \oslash nrm)|).
\end{eqnarray*}
 We also get the analogous formula for the imaginary contribution for the error, so our total error is
bounded by
\begin{eqnarray*}
&&\hskip-24pt (2EPS)(1 + 3EPS/8 + (EPS/4)^2)(1+EPS/2)((|(x \otimes y.{\mathrm re})\oslash nrm|)\\
&&\quad+(|(x \otimes y.{\mathrm
im})\oslash nrm|))\\
&& \le (2EPS)(1 + 3EPS/8 + (EPS/4)^2)(1+EPS/2)^2\\
&&\quad\cdot\ ((|(x \otimes y.{\mathrm re})\oslash nrm|)  \oplus (|(x \otimes
y.{\mathrm im})\oslash nrm|))\\
&&  \le (2EPS)(1 - EPS/2)(1+ 2EPS)\\
&&\quad\cdot\ ((|(x \otimes y.{\mathrm re})\oslash nrm|) \oplus (|(x \otimes y.{\mathrm
im})\oslash nrm|))\\
&&  \le (2EPS) \otimes ((1+ 2EPS) \otimes ((|(x \otimes y.{\mathrm re})\oslash nrm|)\\
&&\quad  \oplus (|(x \otimes y.{\mathrm
im})\oslash nrm|))).
\end{eqnarray*}

Here we used the fact that 
\vglue6pt
\hfill $(1 + 3EPS/8 + (EPS/4)^2)(1+EPS/2)^2 \le (1 - EPS/2)(1+ 2EPS).$ \hfill\qed
\vglue9pt
 
This should give the flavor of division proofs.  As such, we will skip the proofs of $X/X$ and $A/A$ and simply refer to the
 {\textit Annals} web site.
\begin{proposition}\label{GMT prop7.12}{$(X / X)$}
If $x$ and $y$ are {\textrm XComplexes,} then
$S(x / y) \supseteq S(x) / S(y)${\textrm ,} where
\begin{eqnarray*}
x  / y  &\equiv& ({\mathrm re},{\mathrm im};e)\hbox{ with}\\
{\mathrm re}& =& (x.{\mathrm re} \otimes y.{\mathrm re} \oplus x.{\mathrm im} \otimes y.{\mathrm im}) \oslash nrm\\
&&\hbox{ where $nrm = y.{\mathrm
re}
\otimes y.{\mathrm re} \oplus y.{\mathrm im} \otimes y.{\mathrm im}$}\\
{\mathrm im}& = &(x.{\mathrm im} \otimes y.{\mathrm re} \ominus x.{\mathrm re} \otimes y.{\mathrm im}) \oslash nrm\\
e& =& (5EPS/2) \otimes ((1
+  3EPS) \otimes A) \hbox{  where}\\
 A& =& 
((|x.{\mathrm re} \otimes y.{\mathrm re}| \oplus |x.{\mathrm im} \otimes y.{\mathrm im}|)
 \oplus 
 (|x.{\mathrm im} \otimes y.{\mathrm re}| \oplus |x.{\mathrm re} \otimes y.{\mathrm im}|))
\oslash nrm
.\end{eqnarray*}
\end{proposition}

\begin{proposition}\label{GMT prop7.13}{$(A / A)$}
If $x$ and $y$ are {\textrm AComplexes} with 
$y.e < 100 EPS \otimes |y|${\textrm ,} or{\textrm ,} more accurately{\textrm ,}
$$(y.e)^2< ((10000 EPS) \otimes EPS)\otimes nrm$$ then
$S(x / y) \supseteq S(x) / S(y)${\textrm ,} where
\begin{eqnarray*}
x  / y & \equiv& ({\mathrm re},{\mathrm im};e)\hbox{ with}\\
{\mathrm re}& =& (x.{\mathrm re} \otimes y.{\mathrm re} \oplus x.{\mathrm im} \otimes y.{\mathrm im}) \oslash nrm\\
&&\hbox{ where $nrm = y.{\mathrm
re}
\otimes y.{\mathrm re} \oplus y.{\mathrm im} \otimes y.{\mathrm im}$}\\
{\mathrm im}& =& (x.{\mathrm im} \otimes y.{\mathrm re} \ominus x.{\mathrm re} \otimes y.{\mathrm im}) \oslash nrm\\
e& =& (1 + 4EPS)\otimes 
(
((5 EPS/2) \otimes A \oplus (1+103EPS) \otimes B)
\oslash nrm)\hbox{ where}\\
 A& =& (|x.{\mathrm re} \otimes y.{\mathrm re}| \oplus |x.{\mathrm im}\otimes y.{\mathrm im}|) 
 \oplus
(|x.{\mathrm im} \otimes y.{\mathrm re}| \oplus | x.{\mathrm re} \otimes y.{\mathrm im}|)\\
B& =& x.e\otimes(|y.{\mathrm re}|\oplus|y.{\mathrm im}|)
\oplus
   (|x.{\mathrm re}|\oplus|x.{\mathrm im}|)\otimes y.e.
\end{eqnarray*}
\end{proposition}

In our last proposition we will construct the square-root function.  As a warm-up, ignoring round-off error, our
construction is as follows.  If $x = x.{\mathrm re} + i x.{\mathrm im}$ then $\sqrt{x} = s + {\mathrm i d}$ where $s=\sqrt{(|x.{\mathrm
re}| + h(x.{\mathrm re},x.{\mathrm im}))/2}$ and $d = x.{\mathrm im}/(2s)$ when $x.{\mathrm re} > 0.0$, and $\sqrt{x} = d + i s$ otherwise.  
Thus, we take our (no-round-off) square roots to be in the first and fourth quadrants.

\begin{proposition}\label{GMT prop7.14}{($\sqrt{X}$)}
If $x$ is an {\textrm XComplex,} then $S(\sqrt{x}) \supseteq \sqrt{S(x)}$
where we
let $s_o = \root o \of {(|x.{\mathrm re}| \oplus h_o (x.{\mathrm re},x.{\mathrm im})) \otimes 0.5}$
 and $d_o = (x.{\mathrm im} \oslash s) \otimes 0.5${\textrm ,} and define
\begin{eqnarray*}
 \sqrt{x} & \equiv &({\mathrm re},{\mathrm im};e) \hbox{ where }\\
 {\mathrm re} &=& s_o \hbox{ if $x.{\mathrm re} > 0.0$ and $re = d_o$ otherwise},\\
{\mathrm im}& =& d_o \hbox{ if $x.{\mathrm re} > 0.0$ and $im = s_o$ otherwise},
\\
e& =& EPS \otimes ((1 + 4 EPS) \otimes (1.25 \otimes s_o \oplus 1.75 \otimes |d_o|)).
\end{eqnarray*}
\end{proposition}

\begin{proof}{}
This will be a little nasty.  Let us begin by analyzing $e_s$, which is the difference between the true calculation of $s$ and
the machine calculation of~$s$, that is $e_s = |s - s_o|.$   First, we bound $s.$
\begin{eqnarray*}
s &=& \sqrt{(|x.{\mathrm re}| + h(x.{\mathrm re},x.{\mathrm im})) * 0.5}\\
&\le& (1+EPS)^{1/2} \sqrt{(|x.{\mathrm re}| + h_o(x.{\mathrm re},x.{\mathrm im}))
* 0.5}\\
&\le& (1+EPS)^{1/2} (1+EPS/2)^{1/2}
\sqrt{(|x.{\mathrm re}| \oplus h_o(x.{\mathrm re},x.{\mathrm im})) * 0.5}\\
&\le& (1+EPS)^{1/2} (1+EPS/2)^{1/2}\\
&&\cdot\ (1+EPS/2)
\root o \of {(|x.{\mathrm re}| \oplus h_o(x.{\mathrm re},x.{\mathrm im})) * 0.5}\\
&=& (1+EPS)^{1/2} (1+EPS/2)^{3/2} s_o.
\end{eqnarray*}
By a power series expansion, we see that
\begin{eqnarray*}
(1+EPS)^{1/2} (1+EPS/2)^{3/2}&=&\left(1 + {1 \over 2} EPS - {1 \over 8} EPS^2 + \cdots\right)\\
&& +\
     \left(1 + {3 \over 2} EPS/2 + {3 \over 8} (EPS/2)^2 +\cdots\right)\\
&=&\left(1 + {5 \over 4} EPS + {11 \over 32} EPS^2 +\cdots\right),
\end{eqnarray*}
so that,
$$s \le \left(1 + {5 \over 4} EPS + {11 \over 32} EPS^2 + \cdots\right) s_o.$$
Similarly, 
$$s \ge \left(1 - {5 \over 4} EPS\right) s_o.$$

Thus, we can bound the $s$ error, 
\begin{eqnarray*}
e_s = |s - s_o|&\le&\left(\left(1 + {5 \over 4} EPS + {11 \over 32} EPS^2 +\cdots\right) - 1\right) s_o\\
&=& \left({5 \over 4} EPS +
{11 \over 32} EPS^2 +\cdots\right) s_o.
\end{eqnarray*}

Next, we analyze $e_d$, which is the absolute value of the difference between the true calculation of $d$ and the machine calculation of $d$.  That is, $e_d = |d - d_o|.$
\begin{eqnarray*}
e_d &=& |x.{\mathrm im}/(2s) - x.{\mathrm im} \oslash (2 s_o)|\\
&\le& |x.{\mathrm im} \oslash (2 s_o) - x.{\mathrm im} / (2 s_o)| + 
|x.{\mathrm im}/(2s_o) - x.{\mathrm im}/(2s) |\\
&\le& (EPS/2) |x.{\mathrm im} / (2 s_o)| + \left|{x.{\mathrm im} \over 2} {s - s_o \over s s_o} \right|\\
&\le& (EPS/2) |x .{\mathrm im}/ (2
s_o)| +\left|{x.{\mathrm im} \over 2} {1 \over s s_o} ((5/4)EPS + (11/32)EPS^2+\cdots) s_o\right|\\
&\le& (EPS/2) |x.{\mathrm im} / (2
s_o)| \\
&&+ \left|{x.{\mathrm im} \over 2} {1 \over s_o (1 - (5/4)EPS)}((5/4)EPS + (11/32)EPS^2+\cdots)\right|\\
&= &(EPS/2) |x .{\mathrm
im}/ (2 s_o)| \left(1 + {(5/2) + (11/16)EPS+\cdots) \over (1 - (5/4)EPS)}\right)\\
&= &(EPS/2) {(7/2) + (-9/16) EPS +\cdots\over
(1 - (5/4)EPS)} |x .{\mathrm im}/ (2 s_o)|\\
&\le& (EPS/2) (1+EPS/2)
 {7/2 \over (1 - (5/4)EPS)}
|x .{\mathrm im} \oslash (2 s_o)|\\
&= &(EPS/2) (1+EPS/2)
 {7/2 \over (1 - (5/4)EPS)}
|d_o|.
\end{eqnarray*}
 
Finally, we can bound the overall error $e = e_s + e_d$.
\begin{eqnarray*}
e_s + e_d&\le& \left({5 \over 4} EPS + {11 \over 32} EPS^2 +\cdots\right) s_o\\
&& +\
 (EPS/2) (1+EPS/2)
 {7/2 \over (1 - (5/4)EPS)}|d_o|\\
&\le& \left( EPS + {11 \over 40} EPS^2 +\cdots\right) \left({5 \over 4} s_o\right) \\
&&+\
 EPS (1+EPS/2)
 {1 \over (1 - (5/4)EPS)}\left|{7 \over 4} d_o\right|\\
&\le& EPS (1+EPS/2)
 {1 \over (1 - (5/4)EPS)} \left({5 \over 4} s_o\right) \\
&&+
\  EPS (1+EPS/2)
 {1 \over (1 - (5/4)EPS)}\left|{7 \over 4} d_o\right|\\
&\le& EPS (1+EPS/2)
 {1 \over (1 - (5/4)EPS)}
\left({5 \over 4} s_o +\left|{7 \over 4} d_o\right|\right)\\
&\le& EPS (1+EPS/2)^3
 {1 \over (1 - (5/4)EPS)}
\left({5 \over 4} \otimes s_o \oplus \left|{7 \over 4} \otimes d_o\right|\right)\\
&\le& EPS (1 - (EPS/2))(1 + 4 EPS) 
\left({5 \over 4} \otimes s_o \oplus \left|{7 \over 4} \otimes d_o\right|\right)\\
&\le& EPS \otimes \left((1 + 4 EPS) \otimes
\left({5 \over 4} \otimes s_o \oplus \left|{7 \over 4} \otimes d_o\right|\right)\right).\\
\noalign{\vskip-36pt}
\end{eqnarray*}
\end{proof}
 
Now, we develop two formulas for the absolute value of an XComplex.
 

\begin{formula} \label{GMT formula7.0} (${\textrm absUB}(X)$)
If $x$ is an XComplex, then
there is an upper bound on the absolute value of $x$ as follows:
\begin{eqnarray*}
|x| &=& h(x.{\mathrm re},x.{\mathrm im}) \le (1 + EPS) h_{\circ} (x.{\mathrm re},x.{\mathrm im})\\
&\le& (1 - EPS/2) (1 + 2EPS)h_{\circ} (x.{\mathrm re},x.{\mathrm im}) \\
&\le& (1 + 2EPS) \otimes h_{\circ} (x.{\mathrm re},x.{\mathrm im}).
\end{eqnarray*}
Thus, we define 
$${\textrm absUB}(x) = (1 + 2EPS) \otimes h_{\circ} (x.{\mathrm re},x.{\mathrm im}).$$ 
\end{formula}

\begin{formula} \label{GMT formula7.1}(${\textrm absLB}(X)$).
If $x$ is an XComplex, then
we get a lower bound on the absolute value of $x$ as follows.
\begin{eqnarray*}
|x|& =& h(x.{\mathrm re},x.{\mathrm im}) \ge (1 - EPS) h_{\circ} (x.{\mathrm re},x.{\mathrm im})\\
&\ge& (1 + EPS/2) (1 - 2EPS) h_{\circ} (x.{\mathrm
re},x.{\mathrm im})\\
&\ge& (1 - 2EPS) \otimes h_{\circ} (x.{\mathrm re},x.{\mathrm im}).
\end{eqnarray*}
Thus, we define 
$${\textrm absLB}(x) = (1 - 2EPS) \otimes h_{\circ} (x.{\mathrm re},x.{\mathrm im}).$$ \end{formula}
\vglue12pt

Finally, in several places in the {\textit verify} program we perform a standard operation on a pair of doubles and must take into account round-off error.  This is easy if we use Lemma \ref{GMT 7.0}.

For example, in {\textit inequalityHolds} we want to show that $$wh \times wh  > {\textrm absUB}{\textrm (along),}$$ where $wh =
{\textrm absLB}{\textrm (whirle)}.$   
By Lemma \ref{GMT 7.0}, we know that $$(1 - EPS) \otimes (wh \otimes wh) \le wh \times wh$$ and we simply test that 
$$(1 - EPS) \otimes  (wh \otimes wh) \ge {\textrm absUB}{\textrm (along)}.$$

A slightly more complicated version of this occurs in the computer calculation of ${\textrm pos}[i]$ and $size[i],$ that is, the center and size of a sub-box.  Prior to multiplication by ${\textrm scale}[i] = 2 ^{(5 - i)/6},$  the calculations of ${\textrm pos}$ and $size$ are exact.  However, multiplication by $scale$ introduces round-off error.  For the center of the sub-box we will have the computer use ${\textrm pos}[i] \otimes {\textrm scale}[i]$ with the realization that this is not necessarily ${\textrm pos}[i] \times {\textrm scale}[i]$.   Thus, we have to choose appropriate sizes to ensure that the machine sub-box contains the true sub-box.  

Notationally, this is annoying, because we typically use a computer command like ${\textrm pos}[i] = {\textrm pos}[i] \otimes {\textrm scale}[i],$ while in an exposition, we need to avoid that.  We will denote the true center of the sub-box by $p[i]$ and the machine center of the sub-box by $p_0[i],$ and the true and machine sizes will be denoted $s[i]$ and $s_0[i].$  We will let $pos[i]$ and $size[i]$ be the position and size (true and machine are the same) before multiplication by ${\textrm scale}[i].$

Let $p[i] = pos[i] \times {\textrm scale}[i],\ p_0[i] = pos[i] \otimes {\textrm scale}[i],$ and 
$s[i]= size[i] \times {\textrm scale}[i].$  We must select $s_0[i]$ so that 
$p_0[i] + s_0[i] \ge p[i] + s[i].$  (Here, taking $+$ on the left-hand side is correct, because the need for machine calculation there is incorporated at other points in the programs.)  So, we must find $s_0[i]$ such that $s_0[i] \ge (p[i] - p_0[i]) + s[i].$
\begin{eqnarray*}
(p[i] - p_0[i]) + s[i]. &\le& (EPS/2) |p_0[i]| + {\textrm size}[i] \times {\textrm scale}[i]\\[4pt]
&\le& (EPS/2) |p_0[i]| + (1 + EPS/2) ({\textrm size}[i] \otimes
{\textrm scale}[i])\\[4pt]
&\le& (1 + EPS/2) ((EPS/2) |p_0[i]| +  ({\textrm size}[i] \otimes {\textrm scale}[i]))\\[4pt]
&\le& (1 + EPS/2)^2 ((EPS/2) |p_0[i]| \oplus  ({\textrm size}[i]
\otimes {\textrm scale}[i]))\\[4pt]
&\le& (1 + 2EPS) \otimes ((EPS/2) |p_0[i]| \oplus  ({\textrm size}[i] \otimes {\textrm scale}[i])).
\end{eqnarray*}
Thus we take 
$$s_0 [i]= (1 + 2EPS) \otimes ((EPS/2) |p_0[i]| \oplus  ({\textrm size}[i] \otimes {\textrm scale}[i])).$$
This also works to give $p_0[i] - s_0[i] \le p[i] - s[i].$\hfill\qed


 




